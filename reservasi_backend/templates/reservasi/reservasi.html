{% extends 'layout/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-6">
  <!-- Header -->
  <div class="bg-blue-600 text-white rounded-xl p-4 mb-6">
    <h2 class="text-lg font-semibold">Pilih > Detail > <span class="font-bold">Konfirmasi</span></h2>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 text-navy-dark">
    <!-- LEFT FORM -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Info Tamu -->
      <div class="bg-white p-6 rounded-xl shadow">
        <h3 class="text-lg font-bold mb-4">Info Tamu</h3>
        <form method="POST">
          {% csrf_token %}
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" name="first_name" placeholder="Nama depan & tengah" value="{{ form.first_name.value|default_if_none:'' }}" required class="border px-3 py-2 rounded w-full">
            <input type="text" name="last_name" placeholder="Nama belakang" value="{{ form.last_name.value|default_if_none:'' }}" required class="border px-3 py-2 rounded w-full">
            <input type="email" name="email" placeholder="Email" value="{{ form.email.value|default_if_none:'' }}" required class="border px-3 py-2 rounded w-full">
            <input type="text" name="phone" placeholder="Nomor telepon (+62)" value="{{ form.phone.value|default_if_none:'' }}" required class="border px-3 py-2 rounded w-full">
          </div>
          <!-- Check-in, Check-out, dan Room dipindahkan ke dalam form -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div>
              <label class="text-sm font-semibold text-gray-600">Check-in</label>
              <input type="date" name="check_in" value="{{ form.check_in.value|default_if_none:'' }}" required class="border px-3 py-2 rounded w-full">
            </div>
            <div>
              <label class="text-sm font-semibold text-gray-600">Check-out</label>
              <input type="date" name="check_out" value="{{ form.check_out.value|default_if_none:'' }}" required class="border px-3 py-2 rounded w-full">
            </div>
          </div>
          <div class="mt-4">
            <label class="text-sm font-semibold text-gray-600">Pilih Kamar</label>
            <select name="room" required class="border px-3 py-2 rounded w-full">
              <option value="">-- Pilih Kamar --</option>
              {% for r in rooms %}
              <option value="{{ r.id }}" {% if r.id == form.room.value|default_if_none:'' %}selected{% endif %}>
                {{ r.room_type.name }} (No. {{ r.number }})
              </option>
              {% endfor %}
            </select>
          </div>
          {% if form.errors %}
          <div class="bg-red-100 text-red-700 p-4 rounded mb-4 mt-2">
            <p class="font-bold">Terjadi kesalahan:</p>
            <ul class="list-disc list-inside text-sm">
              {% for field in form %}
                {% for error in field.errors %}
                  <li>{{ field.label }}: {{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
      </div>

      <!-- Permintaan Khusus -->
      <div class="bg-white p-6 rounded-xl shadow">
        <h3 class="text-lg font-bold mb-4">Permintaan Khusus <span class="text-sm text-gray-400">(Opsional)</span></h3>
        <div class="space-y-3">
          <textarea name="special_request" rows="3" class="w-full border rounded px-3 py-2" placeholder="Permintaan lain (opsional)">{{ form.special_request.value|default_if_none:'' }}</textarea>
        </div>
      </div>

      <!-- Submit -->
      <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
        Lanjut ke Pembayaran
      </button>
      </form>
    </div>

    <!-- RIGHT SIDEBAR -->
    <div class="bg-white p-6 rounded-xl shadow h-fit">
      <div class="flex items-center gap-4 mb-4">
        {% if hotel.gallery.first %}
        <img src="{{ hotel.gallery.first.image.url }}" class="w-20 h-20 object-cover rounded" alt="{{ hotel.name }}">
        {% else %}
        <img src="{% static 'images/hotel-placeholder.jpg' %}" class="w-20 h-20 object-cover rounded" alt="{{ hotel.name }}">
        {% endif %}
        <div>
          <h4 class="font-bold">{{ hotel.name }}</h4>
          <p class="text-sm text-gray-500">{{ hotel.location }}</p>
        </div>
      </div>

      <hr class="my-4">

      <!-- Ringkasan Harga -->
      <p>Durasi: <strong>{{ durasi }} malam</strong></p>
      <p>Harga per malam: <strong>Rp {{ harga_kamar|intcomma }}</strong></p>
      <p>Total kamar: <strong>Rp {{ total_kamar|intcomma }}</strong></p>
      <p>Pajak & biaya lainnya (10%): <strong>Rp {{ pajak|intcomma }}</strong></p>
      <p class="font-bold text-blue-600 mt-2">Total: Rp {{ total_harga|intcomma }}</p>
    </div>
  </div>
</div>
{% endblock %}